# AI 算法逻辑 v2.0

## 1. 核心设计哲学

AI 控制器采用 **生存优先 (Survival First)** 的分层行为树。
与传统 AI 不同，它不直接寻找“目标物体”，而是寻找“最佳战术位置”。

**核心原则：**

1.  **活着**：任何决策前先检查脚下是否安全。
2.  **可达性**：只选择当前路径能走到的目标（拒绝直线距离诱惑）。
3.  **战术点**：不走到砖块/敌人脸上，而是走到能炸到他们的最远安全距离。

---

## 2. 决策流程 (优先级从高到低)

### 🚨 1. 紧急逃生 (Survival)

- **触发条件**：当前格子危险值 `> 0.05`（脚下有炸弹或在爆炸波及范围内）。
- **逻辑**：
  1. 使用 **BFS** 搜索最近的安全格子（Danger = 0）。
  2. 忽略任何攻击目标，全力奔跑。

### 🚪 2. 终局收割 (Endgame)

- **触发条件**：门已发现 + 场上只剩自己一人。
- **逻辑**：直接规划路径前往门的坐标。

### ⚔️ 3. 攻击与探索 (Combat & Mining)

- **触发条件**：安全且无紧急任务。
- **逻辑**：
  1. **优先敌人**：如果敌人距离 < 5 格，寻找能炸死敌人的最近位置。
  2. **其次砖块**：使用 **泛洪搜索 (Flood Fill)** 寻找最近的“最佳投弹点”。
  3. **行动**：移动到该点 -> 放置炸弹 -> 触发逃生逻辑。

### 🎲 4. 随机游走 (Fallback)

- **触发条件**：无目标或陷入死胡同。
- **逻辑**：每 0.5-1.5 秒随机改变方向，避免呆立不动。

---

## 3. 关键算法详解

### A. 智能目标选择 (BFS Flood Fill)

**解决问题**：避免“目标很近但隔着墙”或“目标太远不搜索”的问题。
**实现逻辑**：

- 不再遍历全图砖块计算曼哈顿距离。
- 从玩家位置开始进行 **BFS 辐射搜索**。
- 对于搜索到的每一个**空格子**，检查：
  1. **攻击判定**：以此为中心，十字线 3 格内是否有砖块/敌人？
  2. **安全判定**：在此放炸弹后，能否在 10 步内逃到安全区？
- **结论**：第一个满足条件的格子，即为**最近、可达且安全**的最佳开火点。

### B. 像素级移动控制 (Axis-Aligned Movement)

**解决问题**：解决“卡墙角”、“进洞失败”和“撞墙不回头”。
**实现逻辑**：

- **互斥对齐策略**：
  - 想横向移动（X 轴变化）？必须先检查 Y 轴是否对齐。
  - 如果 Y 轴偏差 > `2.0` 像素，**强制停止 X 轴移动**，优先修正 Y 轴。
- **效果**：AI 会像是在网格线上滑行，自动对准入口中心，丝滑进洞。

### C. 危险热力图 (Danger Grid)

- **动态计算**：基于炸弹剩余时间计算危险值（时间越短，危险越高）。
- **预判**：不仅标记炸弹位置，还标记所有爆炸波及的十字区域。
- **阈值**：`0.05`。只要有一丝危险，AI 就会放弃攻击转为逃跑。

---

## 4. 性能参数

| 参数               | 设定值 | 说明                             |
| :----------------- | :----- | :------------------------------- |
| **Think Interval** | 100ms  | 决策频率，避免 CPU 过载          |
| **Move Tolerance** | 2.0 px | 移动对齐容差，越小越精准但易抖动 |
| **Bomb Range**     | 3 格   | 判定攻击位置时的射程             |
| **Search Depth**   | 100 步 | 寻找目标的 BFS 最大深度          |
| **Escape Depth**   | 20 步  | 逃命时的最大搜索范围             |

---

## 5. 行为总结

1. **不撞南墙**：通过 BFS 保证路径绝对连通。
2. **不卡墙角**：通过轴对齐策略保证像素级精准移动。
3. **不送人头**：开火前必先模拟爆炸，确认有路可退才放炸弹。
4. **优先活着**：任何时候，生存永远是第一位的。
